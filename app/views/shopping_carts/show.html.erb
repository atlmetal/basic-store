<h1>Mi Carrito</h1>

<div class="row">
  <div class="col-md-8">
    <% if @shopping_cart.items.any? %>
      <div class="card">
        <div class="card-header">
          <h5>Items en el Carrito</h5>
        </div>
        <div class="card-body">
          <% @shopping_cart.items.each do |item| %>
            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
              <div>
                <strong><%= item.product.name %></strong><br>
                <small>SKU: <%= item.product.sku %> | Cantidad: <%= item.quantity %></small>
              </div>
              <div class="text-end">
                <span class="h6">$<%= item.calculate_total %></span><br>
                <%= link_to 'Eliminar', remove_item_path(item), 
                           method: :delete, 
                           class: 'btn btn-sm btn-outline-danger' %>
              </div>
            </div>
          <% end %>
          
          <div class="mt-3 text-end">
            <h4>Total: $<%= @shopping_cart.calculate_total %></h4>
            <%= link_to 'Finalizar Compra', shopping_cart_checkout_path, 
                       method: :post, 
                       class: 'btn btn-success btn-lg',
                       confirm: '¿Confirma la compra?' %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="alert alert-info">
        El carrito está vacío
      </div>
    <% end %>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h5>Agregar Producto</h5>
      </div>
      <div class="card-body">
        <%= form_with url: shopping_cart_add_path, method: :post, local: true do |form| %>
          <div class="mb-3">
            <%= form.label :product_id, 'Producto:', class: 'form-label' %>
            <%= form.select :product_id, 
                           options_from_collection_for_select(@products, :id, :name), 
                           { prompt: 'Seleccionar producto...' }, 
                           { class: 'form-select' } %>
          </div>
          
          <div class="mb-3">
            <%= form.label :quantity, class: 'form-label' %>
            <%= form.number_field :quantity, min: 1, value: 1, class: 'form-control' %>
          </div>
          
          <%= form.submit 'Agregar al Carrito', class: 'btn btn-primary w-100' %>
        <% end %>
      </div>
    </div>
  </div>
</div>